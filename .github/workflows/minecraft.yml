name: Minecraft News to Discord

on:
  schedule:
    - cron: "*/30 * * * *"   # Revisa cada 30 minutos
  workflow_dispatch:

jobs:
  check-news:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Descargar pÃ¡gina de noticias
        run: |
          curl -s https://www.minecraft.net/en-us/articles > page.html

      - name: Obtener tÃ­tulo principal
        run: |
          TITLE=$(grep -m1 "<h3" page.html | sed 's/<[^>]*>//g' | head -n 1)
          echo "$TITLE" > current_title.txt

      - name: Comparar con Ãºltimo tÃ­tulo
        run: |
          if [ -f last_title.txt ]; then
            if cmp -s current_title.txt last_title.txt; then
              echo "No hay noticias nuevas"
              exit 0
            fi
          fi

      - name: Guardar nuevo tÃ­tulo
        run: |
          mv current_title.txt last_title.txt

      - name: Enviar mensaje a Discord
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          TITLE=$(cat last_title.txt)
          curl -X POST -H "Content-Type: application/json" \
          -d "{\"content\":\"ðŸŸ© **Nueva noticia de Minecraft**\nðŸ“° $TITLE\nðŸ”— https://www.minecraft.net/en-us/articles\"}" \
          $DISCORD_WEBHOOK

      - name: Guardar estado
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add last_title.txt
          git commit -m "Actualizar Ãºltima noticia" || echo "Sin cambios"
          git push

